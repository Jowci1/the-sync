<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>THE SYNC</title>

    <meta property="fc:frame" content="vNext" />
    <meta property="fc:frame:image" content="https://the-sync.vercel.app/icon.png" />
    <meta property="fc:frame:button:1" content="ENTER GATE" />

    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: none; }
        html, body { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; color: #fff; font-family: sans-serif; overflow: hidden; }
        
        /* The Gate Screen */
        #gate { position: fixed; inset: 0; z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #000; visibility: visible; }
        #gate-logo { width: 100px; height: 100px; margin-bottom: 20px; border-radius: 20px; border: 1px solid #333; }
        .gate-title { font-size: 3rem; font-style: italic; font-weight: 900; color: #4a90e2; margin: 0; }
        .enter-btn { margin-top: 30px; padding: 16px 60px; background: #fff; color: #000; border: none; border-radius: 50px; font-weight: bold; font-size: 1.2rem; cursor: pointer; }

        /* HUD */
        #hud { display: none; position: absolute; top: 10px; width: 100%; justify-content: space-around; align-items: center; z-index: 10; pointer-events: none; }
        .timer { font-size: 3rem; font-weight: 900; }
        
        /* Targets */
        .target { display: none; position: absolute; width: 80px; height: 80px; z-index: 5; }
        
        /* Modal */
        #modal { display: none; position: fixed; inset: 0; z-index: 200; background: rgba(0,0,0,0.95); flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .box { border: 2px solid #8a44f3; padding: 25px; border-radius: 24px; background: #111; width: 90%; max-width: 320px; }
        .share { display: block; width: 100%; padding: 15px; background: linear-gradient(90deg, #0052ff, #8a44f3); color: #fff; border-radius: 12px; text-decoration: none; margin-top: 20px; font-weight: bold; }

        @keyframes shake { 0%, 100% { transform: translate(0,0); } 20% { transform: translate(-2px, 2px); } 80% { transform: translate(2px, -2px); } }
        .shake { animation: shake 0.1s; }
    </style>
</head>
<body id="body">

    <div id="gate">
        <img id="gate-logo" src="https://the-sync.vercel.app/icon.png">
        <h1 class="gate-title">THE SYNC</h1>
        <button class="enter-btn" id="start-btn">ENTER GATE</button>
    </div>

    <div id="hud">
        <div style="color:#0052ff; font-weight: bold;">B: <span id="bs">0</span></div>
        <div class="timer" id="t">30</div>
        <div style="color:#8a44f3; font-weight: bold;">F: <span id="fs">0</span></div>
    </div>

    <div id="target-b" class="target">
        <svg viewBox="0 0 100 100"><rect x="5" y="5" width="90" height="90" rx="15" fill="#0052ff" stroke="#fff" stroke-width="5"/><text x="50" y="65" text-anchor="middle" font-size="45" font-weight="900" fill="#fff">B</text></svg>
    </div>

    <div id="target-f" class="target">
        <svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="#8a44f3" stroke="#fff" stroke-width="5"/><text x="50" y="65" text-anchor="middle" font-size="45" font-weight="900" fill="#fff">F</text></svg>
    </div>

    <div id="modal">
        <div class="box">
            <div id="loyalty" style="font-weight:bold; margin-bottom:10px; font-size: 1.1rem;"></div>
            <div id="quote" style="font-style:italic; font-size:0.85rem; color:#aaa; margin-bottom:15px; min-height: 40px;"></div>
            <div id="final" style="font-size:3.5rem; font-weight:900;">0</div>
            <a id="share" href="#" class="share">SHARE SCORE</a>
            <button onclick="location.reload()" style="background:none; border:none; color:#555; margin-top:15px; text-decoration:underline;">RETRY</button>
        </div>
    </div>

    <script>
        // Use very simple global variables to ensure Farcaster parses quickly
        var bS = 0, fS = 0, tm = 30, gA = false;
        var bE = document.getElementById('target-b'), fE = document.getElementById('target-f');
        var p = [{x:50, y:200, dx:3.2, dy:3.2}, {x:200, y:350, dx:-3.2, dy:-3.2}];

        document.getElementById('start-btn').onclick = function() {
            document.getElementById('gate').style.display = 'none';
            document.getElementById('hud').style.display = 'flex';
            bE.style.display = fE.style.display = 'block';
            gA = true;
            tick();
            var timerLoop = setInterval(function() {
                if (tm > 0) { tm--; document.getElementById('t').innerText = tm; }
                else { clearInterval(timerLoop); gA = false; done(); }
            }, 1000);
        };

        function tick() {
            if (!gA) return;
            [bE, fE].forEach(function(el, i) {
                p[i].x += p[i].dx; p[i].y += p[i].dy;
                if (p[i].x < 5 || p[i].x > window.innerWidth - 85) p[i].dx *= -1;
                if (p[i].y < 100 || p[i].y > window.innerHeight - 90) p[i].dy *= -1;
                el.style.left = p[i].x + 'px'; el.style.top = p[i].y + 'px';
            });
            requestAnimationFrame(tick);
        }

        function hit(type, e) {
            if (!gA) return;
            if (e && e.cancelable) e.preventDefault();
            if (navigator.vibrate) navigator.vibrate(40);
            document.getElementById('body').classList.remove('shake');
            void document.getElementById('body').offsetWidth;
            document.getElementById('body').classList.add('shake');
            if (type === 'b') { bS++; document.getElementById('bs').innerText = bS; }
            else { fS++; document.getElementById('fs').innerText = fS; }
        }

        // Direct Touch Events for Farcaster Webview stability
        bE.ontouchstart = function(e) { hit('b', e); };
        bE.onmousedown = function(e) { hit('b', e); };
        fE.ontouchstart = function(e) { hit('f', e); };
        fE.onmousedown = function(e) { hit('f', e); };

        function done() {
            var total = bS + fS;
            document.getElementById('final').innerText = total;
            var l = document.getElementById('loyalty'), q = document.getElementById('quote');
            
            if (bS > fS) { 
                l.innerText = "ðŸ”µ Loyalty: Base"; l.style.color="#0052ff"; 
                q.innerText = "Base is for everyone. Built to bring the billion on-chain.";
            } else if (fS > bS) { 
                l.innerText = "ðŸŸ£ Loyalty: Farcaster"; l.style.color="#8a44f3"; 
                q.innerText = "Farcaster is the decentralized social town square.";
            } else { 
                l.innerText = "âš¡ PERFECT SYNC"; l.style.color="#fff"; 
                q.innerText = "Perfect harmony between the chain and the social layer."; 
            }
            
            document.getElementById('modal').style.display = 'flex';
            var txt = encodeURIComponent(l.innerText + "!\nScore: " + total + " on THE SYNC! ðŸ”µðŸŸ£\n@jowci");
            document.getElementById('share').href = "https://warpcast.com/~/compose?text=" + txt + "&embeds[]=" + window.location.origin;
        }
    </script>
</body>
</html>
