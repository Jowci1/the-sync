<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>THE SYNC</title>

    <meta property="fc:frame" content="vNext" />
    <meta property="fc:frame:image" content="https://the-sync.vercel.app/icon.png" />
    <meta property="fc:frame:button:1" content="ENTER GATE" />

    <style>
        body { margin: 0; background-color: black; color: white; font-family: sans-serif; height: 100vh; overflow: hidden; touch-action: none; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            20% { transform: translate(-3px, 0px) rotate(-1deg); }
            40% { transform: translate(3px, 2px) rotate(1deg); }
            60% { transform: translate(-3px, 1px) rotate(-1deg); }
            80% { transform: translate(3px, -2px) rotate(1deg); }
            100% { transform: translate(1px, -1px) rotate(0deg); }
        }
        .shake { animation: shake 0.15s; }

        #gate-screen { position: fixed; inset: 0; background: black; z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 20px; }
        #gate-logo { width: 120px; height: 120px; border-radius: 20px; margin-bottom: 30px; box-shadow: 0 0 30px rgba(138, 68, 243, 0.4); }
        .gate-title { font-size: 3.5rem; font-style: italic; font-weight: 900; color: #4a90e2; letter-spacing: -2px; margin-bottom: 10px; }
        .gate-subtitle { font-size: 1.1rem; color: #888; margin-bottom: 40px; }
        .enter-btn { background: white; color: black; padding: 18px 60px; border-radius: 50px; font-weight: bold; font-size: 1.3rem; border: none; cursor: pointer; text-transform: uppercase; }

        #stats-header { display: none; justify-content: space-around; width: 100%; max-width: 500px; padding: 20px; font-weight: bold; align-items: center; position: absolute; top: 0; pointer-events: none; }
        .base-label { color: #0052ff; font-size: 1.2rem; } 
        .fc-label { color: #8a44f3; font-size: 1.2rem; }
        .timer { font-size: 3.5rem; color: white; font-weight: 900; }

        .target { display: none; position: absolute; cursor: pointer; user-select: none; align-items: center; justify-content: center; font-weight: bold; color: white; transition: transform 0.05s ease-out; }
        #btn-base { width: 65px; height: 65px; background: #0052ff; border: 3px solid white; box-shadow: 0 0 15px #0052ff; border-radius: 8px; font-size: 1.8rem; }
        #btn-fc { width: 75px; height: 75px; background: #8a44f3; border: 4px solid white; border-radius: 50%; box-shadow: 0 0 20px #8a44f3; font-size: 2.2rem; }

        #score-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 3000; flex-direction: column; align-items: center; justify-content: center; }
        .score-box { width: 85%; text-align: center; border: 2px solid #8a44f3; padding: 30px; border-radius: 24px; background: #111; max-width: 350px; }
        .loyalty-text { font-size: 1.1rem; font-weight: bold; margin-bottom: 5px; text-transform: uppercase; }
        .app-quote { font-style: italic; color: #aaa; font-size: 0.9rem; margin-bottom: 15px; line-height: 1.4; }
        .final-val { font-size: 3.5rem; font-weight: 900; color: white; margin-bottom: 10px; }
        .share-btn { display: block; width: 100%; padding: 18px; background: linear-gradient(90deg, #0052ff, #8a44f3); color: white; border-radius: 12px; font-weight: bold; margin-top: 10px; text-decoration: none; font-size: 1.1rem; box-sizing: border-box; }
        .retry-btn { background: none; border: none; color: #888; margin-top: 15px; cursor: pointer; text-decoration: underline; }
    </style>
</head>
<body id="game-body">

    <div id="gate-screen">
        <img id="gate-logo" src="https://the-sync.vercel.app/icon.png">
        <div class="gate-title">THE SYNC</div>
        <div class="gate-subtitle">Capture the Signal. Built by Jowci.</div>
        <button class="enter-btn" onclick="startGame()">ENTER GATE</button>
    </div>

    <div id="stats-header">
        <div class="base-label">BASE: <span id="baseVal">0</span></div>
        <div class="timer" id="timerVal">30</div>
        <div class="fc-label">FC: <span id="fcVal">0</span></div>
    </div>

    <div id="btn-base" class="target">B</div>
    <div id="btn-fc" class="target">F</div>

    <div id="score-modal">
        <div class="score-box">
            <div id="loyalty-display" class="loyalty-text">SYNCING...</div>
            <div id="quote-display" class="app-quote">"Thinking..."</div>
            <h2 style="color:#a78bfa; margin: 0; font-size: 1rem;">TOTAL SYNC SCORE</h2>
            <div id="final-score-display" class="final-val">0</div>
            <a id="share-link" href="#" class="share-btn">SHARE SCORE</a>
            <button class="retry-btn" onclick="location.reload()">PLAY AGAIN</button>
        </div>
    </div>

    <script>
        let baseScore = 0, fcScore = 0, timeLeft = 30, gameActive = false;
        const gameBody = document.getElementById('game-body');
        const targets = [
            { el: document.getElementById('btn-base'), x: 50, y: 250, dx: 3.5, dy: 3.5, w: 65, h: 65 },
            { el: document.getElementById('btn-fc'), x: 200, y: 400, dx: -3.5, dy: -3.5, w: 75, h: 75 }
        ];

        function startGame() {
            document.getElementById('gate-screen').style.display = 'none';
            document.getElementById('stats-header').style.display = 'flex';
            document.getElementById('btn-base').style.display = 'flex';
            document.getElementById('btn-fc').style.display = 'flex';
            gameActive = true;
            moveTargets();
            startTimer();
        }

        function moveTargets() {
            if (!gameActive) return;
            targets.forEach(t => {
                t.x += t.dx; t.y += t.dy;
                if (t.x <= 5 || t.x >= window.innerWidth - t.w - 5) t.dx *= -1;
                if (t.y <= 130 || t.y >= window.innerHeight - t.h - 10) t.dy *= -1;
                t.el.style.left = t.x + 'px'; t.el.style.top = t.y + 'px';
            });
            requestAnimationFrame(moveTargets);
        }

        function handleTap(type) {
            if (!gameActive) return;
            if (navigator.vibrate) navigator.vibrate(40);
            gameBody.classList.remove('shake');
            void gameBody.offsetWidth; 
            gameBody.classList.add('shake');

            if (type === 'base') { 
                baseScore++; document.getElementById('baseVal').innerText = baseScore; 
            } else { 
                fcScore++; document.getElementById('fcVal').innerText = fcScore; 
            }
        }

        document.getElementById('btn-base').addEventListener('touchstart', (e) => { e.preventDefault(); handleTap('base'); });
        document.getElementById('btn-fc').addEventListener('touchstart', (e) => { e.preventDefault(); handleTap('fc'); });

        function startTimer() {
            const timerLoop = setInterval(() => {
                if (timeLeft > 0) {
                    timeLeft--;
                    document.getElementById('timerVal').innerText = timeLeft;
                } else {
                    clearInterval(timerLoop);
                    gameActive = false;
                    endGame();
                }
            }, 1000);
        }

        function endGame() {
            const finalScore = baseScore + fcScore;
            document.getElementById('final-score-display').innerText = finalScore;
            
            const loyaltyDiv = document.getElementById('loyalty-display');
            const quoteDiv = document.getElementById('quote-display');
            let loyaltyTag = "";

            // Personality/Loyalty Logic
            if (baseScore > fcScore) {
                loyaltyTag = "ðŸ”µ Your loyalty lies with Base";
                loyaltyDiv.style.color = "#0052ff";
                quoteDiv.innerText = "Base is for everyone. Itâ€™s a secure, low-cost, builder-friendly Ethereum L2 built to bring the next billion users on-chain.";
            } else if (fcScore > baseScore) {
                loyaltyTag = "ðŸŸ£ Your loyalty lies with Farcaster";
                loyaltyDiv.style.color = "#8a44f3";
                quoteDiv.innerText = "Farcaster is a sufficiently decentralized social network. It is open, so anyone can build an app to read and write data.";
            } else {
                loyaltyTag = "âš¡ You are perfectly synced";
                loyaltyDiv.style.color = "white";
                quoteDiv.innerText = "A perfect balance between the social layer and the chain. You are the ultimate builder.";
            }

            loyaltyDiv.innerText = loyaltyTag;
            document.getElementById('score-modal').style.display = 'flex';
            
            const text = encodeURIComponent(`${loyaltyTag}!\nI achieved a Sync Score of ${finalScore} on THE SYNC! ðŸ”µðŸŸ£\nBuilt by @jowci`);
            document.getElementById('share-link').href = `https://warpcast.com/~/compose?text=${text}&embeds[]=${window.location.origin}`;
        }
    </script>
</body>
</html>
